'\" te
.\" This manual page is derived from the DAT/uDAPL 1.2 specification.
.\" Portions Copyright (c) 2007, Sun Microsystems, Inc. All Rights Reserved.
.\" CDDL HEADER START
.\"
.\" The contents of this file are subject to the terms of the
.\" Common Development and Distribution License (the "License").
.\" You may not use this file except in compliance with the License.
.\"
.\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
.\" or http://www.opensolaris.org/os/licensing.
.\" See the License for the specific language governing permissions
.\" and limitations under the License.
.\"
.\" When distributing Covered Code, include this CDDL HEADER in each
.\" file and include the License file at usr/src/OPENSOLARIS.LICENSE.
.\" If applicable, add the following below this CDDL HEADER, with the
.\" fields enclosed by brackets "[]" replaced with your own identifying
.\" information: Portions Copyright [yyyy] [name of copyright owner]
.\"
.\" CDDL HEADER END
.TH dat_ep_dup_connect 3DAT "16 Jul 2004" "SunOS 5.11" "Direct Access Transport Library Functions"
.SH NAME
dat_ep_dup_connect \- establish a connection between the local Endpoint and
a remote Endpoint
.SH SYNOPSIS
.LP
.nf
cc [ \fIflag\fR\&.\|.\|. ] \fIfile\fR\&.\|.\|. \fB-ldat\fR [ \fIlibrary\fR\&.\|.\|. ]
#include <\fBdat/udat.h\fR>

DAT_RETURN
    dat_ep_dup_connect (
    IN    DAT_EP_HANDLE    ep_handle,
    IN    DAT_EP_HANDLE    dup_ep_handle,
    IN    DAT_TIMEOUT      timeout,
    IN    DAT_COUNT        private_data_size,
    IN const  DAT_PVOID    private_data,
    IN    DAT_QOS          qos
    )
.fi

.SH PARAMETERS
.sp
.ne 2
.mk
.na
.I ep_handle
.ad
.RS 21n
.rt
Handle for an instance of an Endpoint.
.RE

.sp
.ne 2
.mk
.na
.I dup_ep_handle
.ad
.RS 21n
.rt
Connected local Endpoint that specifies a requested connection remote
end.
.RE

.sp
.ne 2
.mk
.na
.I timeout:
.ad
.RS 21n
.rt
Duration of time, in microseconds, that Consumers wait for Connection
establishment. The value of
.B DAT_TIMEOUT_INFINITE
represents no
timeout, indefinite wait. Values must be positive.
.RE

.sp
.ne 2
.mk
.na
.I private_data_size
.ad
.RS 21n
.rt
Size of
.IR private_data .
Must be nonnegative.
.RE

.sp
.ne 2
.mk
.na
.I private_data
.ad
.RS 21n
.rt
Pointer to the private data that should be provided to the remote Consumer
as part of the Connection Request. If
.I private_data_size
is zero, then
\fIprivate_data\fR can be \fINULL\fR.
.RE

.sp
.ne 2
.mk
.na
.I qos
.ad
.RS 21n
.rt
Requested Quality of Service of the connection.
.RE

.SH DESCRIPTION
.sp
.LP
The
.B dat_ep_dup_connect()
function requests that a connection be
established between the local Endpoint and a remote Endpoint. This operation
is used by the active/client side Consumer of the connection model. The
remote Endpoint is identified by the
.IR dup_ep_handle .
The remote end of
the requested connection shall be the same as the remote end of the
.IR dup_ep_handle .
This is equivalent to requesting a connection to the
same remote IA, Connection Qualifier, and \fIconnect_flags\fR as used for
establishing the connection on duplicated Endpoints and following the same
redirections.
.sp
.LP
Upon establishing the requested connection as part of the successful
completion of this operation, the local Endpoint is bound to a Port
Qualifier of the local IA. The Port Qualifier is passed to the remote side
of the requested connection and is available to the remote Consumer in the
Connection Request of the
.BR DAT_CONNECTION_REQUEST_EVENT .
.sp
.LP
The Consumer-provided
.I private_data
is passed to the remote side and
is provided to the remote Consumer in the Connection Request. Consumers can
encapsulate any local Endpoint attributes that remote Consumers need to know
as part of an upper-level protocol. Providers can also provide a Provider on
the remote side any local Endpoint attributes and Transport-specific
information needed for Connection establishment by the Transport.
.sp
.LP
Upon successful completion of this operation, the local Endpoint is
transferred into
.BR DAT_EP_STATE_ACTIVE_CONNECTION_PENDING .
.sp
.LP
Consumers can request a specific value of
.IR qos .
The Provider specifies
which Quality of Service it supports in documentation and in the Provider
attributes. If the local Provider or Transport does not support the
requested
.IR qos ,
the operation fails and
.BR DAT_MODEL_NOT_SUPPORTED
is returned synchronously. If the remote Provider does not support the
requested
.IR qos ,
the local Endpoint is automatically transitioned into a
\fBDAT_EP_STATE_UNDISCONNECTED\fR state, the connection is not established,
and the event returned on the
.I connect_evd_handle
is
.BR DAT_CONNECTION_EVENT_NON_PEER_REJECTED .
The same
\fBDAT_CONNECTION_EVENT_NON_PEER_REJECTED\fR event is returned if connection
cannot be established for all reasons for not establishing the connection,
except timeout, remote host not reachable, and remote peer reject. For
example, remote host is not reachable, remote Consumer is not listening on
the requested Connection Qualifier, Backlog of the requested Service Point
is full, and Transport errors. In this case, the local Endpoint is
automatically transitioned into a
.B DAT_EP_STATE_UNDISCONNECTED
state.
.sp
.LP
The acceptance of the requested connection by the remote Consumer is
reported to the local Consumer through a
\fBDAT_CONNECTION_EVENT_ESTABLISHED\fR event on the \fIconnect_evd_handle\fR
of the local Endpoint.
.sp
.LP
The rejection of the connection by the remote Consumer is reported to the
local Consumer through a
.B DAT_CONNECTION_EVENT_PEER_REJECTED
event on
the
.I connect_evd_handle
of the local Endpoint and the local Endpoint is
automatically transitioned into a
.B DAT_EP_STATE_UNDISCONNECTED
state.
.sp
.LP
When the Provider cannot reach the remote host or the remote host does not
respond within the Consumer-requested
.IR timeout ,
a
\fBDAT_CONNECTION_EVENT_UNREACHABLE\fR is generated on the
\fIconnect_evd_handle\fR of the Endpoint. The Endpoint transitions into a
\fBDAT_EP_STATE_DISCONNECTED\fR state.
.sp
.LP
The local Endpoint is automatically transitioned into a
\fBDAT_EP_STATE_CONNECTED\fR state when a Connection Request is accepted by
the remote Consumer and the Provider completes the Transport-specific
Connection establishment. The local Consumer is notified of the established
connection through a
.B DAT_CONNECTION_EVENT_ESTABLISHED
event on the
\fIconnect_evd_handle\fR of the local Endpoint.
.sp
.LP
When the
.I timeout
expired prior to completion of the Connection
establishment, the local Endpoint is automatically transitioned into a
\fBDAT_EP_STATE_UNDISCONNECTED\fR state and the local Consumer through a
\fBDAT_CONNECTION_EVENT_TIMED_OUT\fR event on the \fIconnect_evd_handle\fR
of the local Endpoint.
.SH RETURN VALUES
.sp
.ne 2
.mk
.na
.B DAT_SUCCESS
.ad
.RS 30n
.rt
The operation was successful.
.RE

.sp
.ne 2
.mk
.na
.B DAT_INSUFFICIENT_RESOURCES
.ad
.RS 30n
.rt
The operation failed due to resource limitations.
.RE

.sp
.ne 2
.mk
.na
.B DAT_INVALID_PARAMETER
.ad
.RS 30n
.rt
Invalid parameter.
.RE

.sp
.ne 2
.mk
.na
.B DAT_INVALID_HANDLE
.ad
.RS 30n
.rt
The
.I ep_handle
or
.I dup_ep_handle
parameter is invalid.
.RE

.sp
.ne 2
.mk
.na
.B DAT_INVALID_STATE
.ad
.RS 30n
.rt
A parameter is in an invalid state.
.RE

.sp
.ne 2
.mk
.na
.B DAT_MODEL_NOT_SUPPORTED
.ad
.RS 30n
.rt
The requested Model is not supported by the Provider. For example,
requested
.I qos
was not supported by the local Provider.
.RE

.SH USAGE
.sp
.LP
It is up to the Consumer to negotiate outstanding RDMA Read incoming and
outgoing with a remote peer. The outstanding RDMA Read outgoing attribute
should be smaller than the remote Endpoint outstanding RDMA Read incoming
attribute. If this is not the case, connection establishment might fail.
.sp
.LP
DAT API does not define a protocol on how remote peers exchange Endpoint
attributes. The exchange of outstanding RDMA Read incoming and outgoing
attributes of EPs is left to the Consumer ULP. The Consumer can use Private
Data for it.
.sp
.LP
If the Consumer does not care about posting RDMA Read operations or remote
RDMA Read operations on the connection, it can set the two outstanding RDMA
Read attribute values to 0.
.sp
.LP
If the Consumer does not set the two outstanding RDMA Read attributes of
the Endpoint, the Provider is free to pick up any values as a default. The
Provider is allowed to change these default values during connection
setup.
.SH ATTRIBUTES
.sp
.LP
See
.BR attributes (5)
for descriptions of the following attributes:
.sp

.sp
.TS
tab() box;
cw(2.75i) |cw(2.75i)
lw(2.75i) |lw(2.75i)
.
ATTRIBUTE TYPEATTRIBUTE VALUE
_
Interface StabilityStandard: uDAPL, 1.1, 1.2
_
MT-LevelUnsafe
.TE

.SH SEE ALSO
.sp
.LP
.BR libdat (3LIB),
.BR attributes (5)
