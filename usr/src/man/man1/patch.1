'\" te
.\" Copyright (c) 1992, X/Open Company Limited  All Rights Reserved
.\" Portions Copyright (c) 2007, Sun Microsystems, Inc.  All Rights Reserved
.\" Copyright (c) 2012-2013, J. Schilling
.\" Copyright (c) 2013, Andreas Roehler
.\"
.\" Sun Microsystems, Inc. gratefully acknowledges The Open Group for
.\" permission to reproduce portions of its copyrighted documentation.
.\" Original documentation from The Open Group can be obtained online
.\" at http://www.opengroup.org/bookstore/.
.\"
.\" The Institute of Electrical and Electronics Engineers and The Open Group,
.\" have given us permission to reprint portions of their documentation.
.\"
.\" In the following statement, the phrase "this text" refers to portions
.\" of the system documentation.
.\"
.\" Portions of this text are reprinted and reproduced in electronic form in
.\" the Sun OS Reference Manual, from IEEE Std 1003.1, 2004 Edition, Standard
.\" for Information Technology -- Portable Operating System Interface (POSIX),
.\" The Open Group Base Specifications Issue 6, Copyright (C) 2001-2004 by the
.\" Institute of Electrical and Electronics Engineers, Inc and The Open Group.
.\" In the event of any discrepancy between these versions and the original
.\" IEEE and The Open Group Standard, the original IEEE and The Open Group
.\" Standard is the referee document.
.\"
.\" The original Standard can be obtained online at
.\" http://www.opengroup.org/unix/online.html.
.\"
.\" This notice shall appear on any product containing this material.
.\"
.\" CDDL HEADER START
.\"
.\" The contents of this file are subject to the terms of the
.\" Common Development and Distribution License ("CDDL"), version 1.0.
.\" You may only use this file in accordance with the terms of version
.\" 1.0 of the CDDL.
.\"
.\" A full copy of the text of the CDDL should have accompanied this
.\" source.  A copy of the CDDL is also available via the Internet at
.\" http://www.opensource.org/licenses/cddl1.txt
.\"
.\" When distributing Covered Code, include this CDDL HEADER in each
.\" file and include the License file at usr/src/OPENSOLARIS.LICENSE.
.\" If applicable, add the following below this CDDL HEADER, with the
.\" fields enclosed by brackets "[]" replaced with your own identifying
.\" information: Portions Copyright [yyyy] [name of copyright owner]
.\"
.\" CDDL HEADER END
.TH patch 1 "17 Jul 2007" "SunOS 5.11" "User Commands"
.SH NAME
patch \- apply changes to files
.SH SYNOPSIS
.LP
.nf
\fBpatch\fR [\fB-blNR\fR] [\fB-c\fR | \fB-e\fR | \fB-n\fR | \fB-u\fR] [\fB-d\fR \fIdir\fR] [\fB-D\fR \fIdefine\fR]
     [\fB-i\fR \fIpatchfile\fR] [\fB-o\fR \fIoutfile\fR] [\fB-p\fR \fInum\fR] [\fB-r\fR \fIrejectfile\fR]
     [\fIfile\fR]
.fi

.SH DESCRIPTION
.sp
.LP
The
.B patch
command reads a source (patch) file containing any of the
three forms of difference (diff) listings produced by the
.BR diff (1)
command (normal, context or in the style of
.BR ed (1))
and apply those
differences to a file.  By default,
.B patch
reads from the standard
input.
.sp
.LP
.B patch
attempts to determine the type of the
.B diff
listing,
unless overruled by a
.BR -c ,
.BR -e ,
or
.B -n
option.
.sp
.LP
If the patch file contains more than one patch,
.B patch
attempts to
apply each of them as if they came from separate patch files. (In this case
the name of the patch file must be determinable for each
.B diff
listing.)
.SH OPTIONS
.sp
.LP
The following options are supported:
.sp
.ne 2
.mk
.na
.B -b
.ad
.RS 13n
.rt
Saves a copy of the original contents of each modified file, before the
differences are applied, in a file of the same name with the suffix
\fB\&.orig\fR appended to it. If the file already exists, it is overwritten.
If multiple patches are applied to the same file, the \fB\&.orig\fR file is
written only for the first patch. When the
.B -o
.I outfile
option is
also specified, \fIfile\fB\&.orig\fR is not created but, if \fIoutfile\fR
already exists, \fIoutfile\fB\&.orig\fR is created.
.RE

.sp
.ne 2
.mk
.na
.B -c
.ad
.RS 13n
.rt
Interprets the patch file as a context difference (the output of the
command \fBdiff\fR when the \fB-c\fR or
.B -C
options are specified).
.RE

.sp
.ne 2
.mk
.na
.B -d
.I dir
.ad
.RS 13n
.rt
Changes the current directory to
.I dir
before processing as described
in
.BR "EXTENDED DESCRIPTION" .
.RE

.sp
.ne 2
.mk
.na
.B -D
.I define
.ad
.RS 13n
.rt
Marks changes with the C preprocessor construct:
.sp
.in +2
.nf
\fB#ifdef\fR \fIdefine\fR
\&.\|.\|.
#endif
.fi
.in -2
.sp

.RE

.sp
.LP
The option-argument
.I define
is used as the differentiating symbol.
.sp
.ne 2
.mk
.na
.B -e
.ad
.RS 17n
.rt
Interprets the patch file as an
.B ed
script, rather than a
.B diff
script.
.RE

.sp
.ne 2
.mk
.na
.B -i
.I patchfile
.ad
.RS 17n
.rt
Reads the patch information from the file named by the path name
.IR patchfile ,
rather than the standard input.
.RE

.sp
.ne 2
.mk
.na
.B -l
.ad
.RS 17n
.rt
(The letter ell.) Causes any sequence of blank characters in the difference
script to match any sequence of blank characters in the input file. Other
characters is matched exactly.
.RE

.sp
.ne 2
.mk
.na
.B -n
.ad
.RS 17n
.rt
Interprets the script as a normal difference.
.RE

.sp
.ne 2
.mk
.na
.B -N
.ad
.RS 17n
.rt
Ignores patches where the differences have already been applied to the
file; by default, already-applied patches are rejected.
.RE

.sp
.ne 2
.mk
.na
.B -o
.I outfile
.ad
.RS 17n
.rt
Instead of modifying the files (specified by the
.I file
operand or the
difference listings) directly, writes a copy of the file referenced by each
patch, with the appropriate differences applied, to
.IR outfile .
Multiple
patches for a single file is applied to the intermediate versions of the
file created by any previous patches, and results  in multiple, concatenated
versions of the file being written to
.IR outfile .
.RE

.sp
.ne 2
.mk
.na
.B -p
.I num
.ad
.RS 17n
.rt
For all path names in the patch file that indicate the names of files to be
patched, deletes
.I num
path name components from the beginning of each
path name. If the path name in the patch file is absolute, any leading
slashes are considered the first component (that is,
.B "-p 1"
removes the leading slashes). Specifying
.B "-p 0"
causes the full
path name to be used. If
.B -p
is not specified, only the basename (the
final path name component) is used.
.RE

.sp
.ne 2
.mk
.na
.B -R
.ad
.RS 17n
.rt
Reverses the sense of the patch script. That is, assumes that the
difference script was created from the new version to the old version. The
.B -R
option cannot be used with
.B ed
scripts.
.B patch
attempts
to reverse each portion of the script before applying it. Rejected
differences is saved in swapped format. If this option is not specified, and
until a portion of the patch file is successfully applied,
.B patch
attempts to apply each portion in its reversed sense as well as in its
normal sense. If the attempt is successful, the user is prompted to
determine if the
.B -R
option should be set.
.RE

.sp
.ne 2
.mk
.na
.B -r
.I rejectfile
.ad
.RS 17n
.rt
Overrides the default reject file name. In the default case, the reject
file has the same name as the output file, with the suffix \fB\&.rej\fR
appended to it. See
.BR "Patch Application" .
.RE

.sp
.ne 2
.mk
.na
.B -u
.ad
.RS 17n
.rt
Interprets the patch file as a unified context difference, that is, the
output of the command
.B diff
when the
.B -u
or
.B -U
options are
specified.
.RE

.SH OPERANDS
.sp
.LP
The following operand is supported:
.sp
.ne 2
.mk
.na
.I file
.ad
.RS 8n
.rt
A path name of a file to patch.
.RE

.SH USAGE
.sp
.LP
The
.B -R
option does not work with
.B ed
scripts because there is
too little information to reconstruct the reverse operation.
.sp
.LP
The
.B -p
option makes it possible to customize a patch file to local
user directory structures without manually editing the patch file. For
example, if the file name in the patch file was
.BR /curds/whey/src/blurfl/blurfl.c :
.RS +4
.TP
.ie t \(bu
.el o
Setting
.B "-p 0"
gives the entire path name unmodified.
.RE
.RS +4
.TP
.ie t \(bu
.el o
Setting
.B "-p 1"
gives:
.sp
.in +2
.nf
curds/whey/src/blurfl/blurfl.c
.fi
.in -2
.sp

.RE
.RS +4
.TP
.ie t \(bu
.el o
Without the leading slash,
.B "-p 4"
gives:
.sp
.in +2
.nf
blurfl/blurfl.c
.fi
.in -2
.sp

.RE
.RS +4
.TP
.ie t \(bu
.el o
Not specifying
.B -p
at all gives:
.sp
.in +2
.nf
blurfl.c
.fi
.in -2
.sp

.RE
.sp
.LP
When using
.B -b
in some file system implementations, the saving of a
\fB\&.orig\fR file might produce unwanted results. In the case of 12-, 13-,
or 14-character file names, on file systems supporting 14-character maximum
file names, the \fB\&.orig\fR file overwrites the new file.
.SH ENVIRONMENT VARIABLES
.sp
.LP
See
.BR environ (5)
for descriptions of the following environment
variables that affect the execution of
.BR patch :
.BR LANG ,
.BR LC_ALL ,
.BR LC_COLLATE ,
.BR LC_CTYPE ,
.BR LC_MESSAGES ,
.BR LC_TIME ,
and
.BR NLSPATH .
.sp
.LP
Affirmative responses are processed using the extended regular expression
defined for the
.B yesexpr
keyword in the
.B LC_MESSAGES
category of
the user's locale. The locale specified in the
.B LC_COLLATE
category
defines the behavior of ranges, equivalence classes, and multi-character
collating elements used in the expression defined for
.BR yesexpr .
The
locale specified in
.B LC_CTYPE
determines the locale for interpretation
of sequences of bytes of text data a characters, the behavior of character
classes used in the expression defined for the
.BR yesexpr .
See
.BR locale (5).
.SH OUTPUT FILES
.sp
.LP
The output of
.B patch
the save files (\fB\&.orig\fR suffixes) and the
reject files (\fB\&.rej\fR suffixes) are text files.
.SH EXTENDED DESCRIPTION
.sp
.LP
A patch file can contain patching instructions for more than one file. File
names are determined as specified in
.BR "Patch Determination" .
When the
.B -b
option is specified, for each patched file, the original is saved
in a file of the same name with the suffix \fB\&.orig\fR appended to it.
.sp
.LP
For each patched file, a reject file can also be created as noted in
.BR "Patch Application" .
In the absence of an
.B -r
option, the name of
this file is formed by appending the suffix \fB\&.rej\fR to the original
file name.
.SS "Patch File Format"
.sp
.LP
The patch file must contain zero or more lines of header information
followed by one or more patches. Each patch must contain zero or more lines
of file name identification in the format produced by
.BR "diff -c" ,
and one or more sets of
.B diff
output, which are customarily called
hunks.
.sp
.LP
.B patch
recognizes the following expression in the header
information:
.sp
.ne 2
.mk
.na
.BI Index: pathname
.ad
.RS 18n
.rt
The file to be patched is named
.IR pathname .
.RE

.sp
.LP
If all lines (including headers) within a patch begin with the same leading
sequence of blank characters,
.B patch
removes this sequence before
proceeding. Within each patch, if the type of difference is context,
.B patch
recognizes the following expressions:
.sp
.ne 2
.mk
.na
\fB*\|*\|*\|\fR \fIfilename timestamp\fR
.ad
.sp .6
.RS 4n
The patches arose from
.IR filename .
.RE

.sp
.ne 2
.mk
.na
\fB\(mi\|\(mi\|\(mi\fR \fIfilename timestamp\fR
.ad
.sp .6
.RS 4n
The patches should be applied to
.IR filename .
.RE

.sp
.LP
Each hunk within a patch must be the
.B diff
output to change a line
range within the original file. The line numbers for successive hunks within
a patch must occur in ascending order.
.SS "File Name Determination"
.sp
.LP
If no \fIfile\fR operand is specified,
.B patch
performs the following
steps to obtain a path name:
.RS +4
.TP
1.
If the patch contains the strings
.B ***
and
\fB\(mi\|\(mi\|\(mi\fI,\fR
.B patch
strips components from the
beginning of each path name (depending on the presence or value of the
.B -p
option), then tests for the existence of both files in the current
directory (or directory specified with the
.B -d
option).
.RE
.RS +4
.TP
2.
If both files exist,
.B patch
assumes that no path name can be obtained
from this step. If the header information contains a line with the string
.BR Index: ,
.B patch
strips components from the beginning of the path
name (depending on
.BR -p ),
then tests for the existence of this file in
the current directory (or directory specified with the
.B -d
option).
.RE
.RS +4
.TP
3.
If an
.B SCCS
.RB "directory exists in the current directory," " patch"
attempts to perform a
.B "get -e"
.BI SCCS/s. filename
command
to retrieve an editable version of the file.
.RE
.RS +4
.TP
4.
If no path name can be obtained by applying the previous steps, or if the
path names obtained do not exist,
.B patch
writes a prompt to standard
output and request a file name interactively from standard input.
.RE
.SS "Patch Application"
.sp
.LP
If the
.BR -c ,
.BR -e ,
.BR -n ,
or
.B -u
option is present,
.B patch
interprets information within each hunk as a context difference,
an
.B ed
difference, a normal difference, or a unified context
difference, respectively. In the absence of any of these options,
.B patch
determines the type of difference based on the format of
information within the hunk.
.sp
.LP
For each hunk,
.B patch
begins to search for the place to apply the
patch at the line number at the beginning of the hunk, plus or minus any
offset used in applying the previous hunk. If lines matching the hunk
context are not found,
.B patch
scans both forwards and backwards at
least 1000 bytes for a set of lines that match the hunk context.
.sp
.LP
If no such place is found and it is a context difference, then another scan
takes place, ignoring the first and last line of context. If that fails, the
first two and last two lines of context is ignored and another scan is made.
Implementations can search more extensively for installation locations.
.sp
.LP
If no location can be found,
.B patch
appends the hunk to the reject
file. The rejected hunk is written in context-difference format regardless
of the format of the patch file. If the input was a normal or
.B ed
.B -style
difference, the reject file can contain differences with zero
lines of context. The line numbers on the hunks in the reject file can be
different from the line numbers in the patch file since they reflect the
approximate locations for the failed hunks in the new file rather than the
old one.
.sp
.LP
If the type of patch is an
.B ed
diff, the implementation can accomplish
the patching by invoking the
.B ed
command.
.SH EXIT STATUS
.sp
.LP
The following exit values are returned:
.sp
.ne 2
.mk
.na
.B 0
.ad
.RS 6n
.rt
Successful completion.
.RE

.sp
.ne 2
.mk
.na
.B 1
.ad
.RS 6n
.rt
One or more lines were written to a reject file.
.RE

.sp
.ne 2
.mk
.na
.B >1
.ad
.RS 6n
.rt
An error occurred.
.RE

.SH ATTRIBUTES
.sp
.LP
See
.BR attributes (5)
for descriptions of the following attributes:
.sp

.sp
.TS
tab() box;
cw(2.75i) |cw(2.75i)
lw(2.75i) |lw(2.75i)
.
ATTRIBUTE TYPEATTRIBUTE VALUE
_
AvailabilitySUNWcsu
_
Interface StabilityStandard
.TE

.SH SEE ALSO
.sp
.LP
.BR ed (1),
.BR diff (1),
.BR attributes (5),
.BR environ (5),
.BR standards (5)
